{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-1">Documentos</h2>
    <p class="text-muted mb-0">Control de documentos de toda la flota</p>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div class="btn-group" role="group">
    <a href="{% url 'documento_list' %}"
       class="btn btn-outline-light {% if not estado %}active{% endif %}">
      Todos ({{ total_todos }})
    </a>
    <a href="{% url 'documento_list' %}?estado=proximos"
       class="btn btn-outline-warning {% if estado == 'proximos' %}active{% endif %}">
      Próximos ({{ total_proximos }})
    </a>
    <a href="{% url 'documento_list' %}?estado=vencidos"
       class="btn btn-outline-danger {% if estado == 'vencidos' %}active{% endif %}">
      Vencidos ({{ total_vencidos }})
    </a>
    <a href="{% url 'documento_list' %}?estado=vigentes"
       class="btn btn-outline-success {% if estado == 'vigentes' %}active{% endif %}">
      Vigentes ({{ total_vigentes }})
    </a>
  </div>

  <div>
    <a
      href="{% url 'documento_export_csv' %}{% if estado %}?estado={{ estado }}{% endif %}"
      class="btn btn-outline-light btn-sm"
    >
      <i class="bi bi-file-earmark-spreadsheet me-1"></i> Exportar CSV
    </a>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover mb-0">
    <thead>
      <tr>
        <th>Vehículo</th>
        <th>Tipo</th>
        <th>Fecha expedición</th>
        <th>Fecha vencimiento</th>
        <th>Estado</th>
        <th>Responsable</th>
        <th>Archivo</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for doc in documentos %}
        <tr>
          <td>
            <a href="{% url 'vehiculo_detail' doc.vehiculo.pk %}">
              {{ doc.vehiculo.placa }}
            </a>
          </td>
          <td>{{ doc.tipo.nombre }}</td>
          <td>{{ doc.fecha_expedicion|default:"-" }}</td>
          <td>{{ doc.fecha_vencimiento }}</td>
          <td>
            {% if doc.estado == 'vencido' %}
              <span class="badge text-bg-danger">Vencido</span>
            {% elif doc.estado == 'proximo' %}
              <span class="badge text-bg-warning text-dark">Próximo</span>
            {% else %}
              <span class="badge text-bg-success">Vigente</span>
            {% endif %}
          </td>
          <td>
            {% if doc.vehiculo.responsable_nombre %}
              {{ doc.vehiculo.responsable_nombre }}
              {% if doc.vehiculo.responsable_email %}
                <br><small class="text-muted">{{ doc.vehiculo.responsable_email }}</small>
              {% endif %}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if doc.archivo %}
              <a href="{{ doc.archivo.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-box-arrow-up-right"></i> Ver
              </a>
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            <a href="{% url 'documento_update' doc.pk %}" class="btn btn-sm btn-secondary mb-1">
              <i class="bi bi-pencil"></i>
            </a>
            <a href="{% url 'documento_delete' doc.pk %}" class="btn btn-sm btn-outline-danger">
              <i class="bi bi-trash"></i>
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="8">No hay documentos para mostrar.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
